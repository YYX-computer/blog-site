
<!DOCTYPE html>
 
<html>
	<head>
		<meta charset='utf-8'>
		<title>BLOG--ME</title>
		<style>
			#divContainer{
				margin-top: 20px;
				text-align: center;
			}
			#cv{
				width: 300px;
				height: 200px;
				border-bottom: 2px solid #000;
				border-left: 2px solid #000;
			}
		</style>
	</head>
	<body>
		<div align="left">
			<input type="button" id="wirte" value="write"/>
			<br />
			<input type="button" id="data" value="data"/>
			<br />
			<input type="button" id="comments" value="comments"/>
			<br />
			<input type="button" id="follow" value="follow"/>
		</div>
		<div align="right">
			<div id="dataDiv" style="visibility:hidden;">
			<input type="date" id="date" />
			<input type="button" id="btn" value="submit" />
			<br />
			<canvas id="cv" >你的设备不支持图表数据显示</canvas>
		</div>
		<script>
			function getDateOf(date){
				var da = new Date
				var ymd = date.split('-')
				var y = ymd[0],m = ymd[1],d = ymd[2]
				da.setFullYear(eval(y))
				da.setMonth(eval(m) - 1)
				da.setDate(eval(d))
				return da
			}
			function toDateString(dat){
				var y = dat.getFullYear()
				var m = dat.getMonth() + 1
				var d = dat.getDate()
				return y + '-' + m + '-' + d
			}
			function changeDate(dat,day){
				return new Date(Number(dat) + 86400000 * day)
			}
			function getVal(dat){
				return 12345
			}
			var btn = document.getElementById('btn')
			function load(){
				var date = document.getElementById('date')
				if(!date.value){
					return
				}else{
					date = getDateOf(date.value)
				}
				//数据源
				var dict = []
				for(var i = 0;i < 10;i = i + 1){
					dict = dict.concat([{x:toDateString(date),y:getVal(toDateString(date))}])
					date = changeDate(date,1)
				}
				//数据源提取
				var len = dict.length;
				var xArr = [], yArr = [], tmp_yArr = [];
				for(var i=0; i<len; i++){
					xArr.push(i * 60);
					tmp_yArr.push(dict[i].y);
				}
				var tmp_minY = Math.min.apply(Math, tmp_yArr);//最小值
				var tmp_maxY = Math.max.apply(Math, tmp_yArr);//最大值
				if(tmp_maxY - tmp_minY <= 100){
					for(var i=0; i<len; i++){
						yArr.push(tmp_yArr[i] - tmp_minY + 50);//与最小的做比较
					}
				}
				else{//如果相差太大会导致图表不美观
					for(var i=0; i<len; i++){
						yArr.push(tmp_yArr[i] / 500);
					}
				}
				var minY = Math.min.apply(Math, yArr);
				var maxY = Math.max.apply(Math, yArr);

				//canvas 准备
				var canvas = document.getElementById("cv");//获取canvas画布
				var ctx  = canvas.getContext("2d");
				ctx.clearRect(0,0,canvas.width,canvas.height)

				//画折线
				for(var i=0 ;i<len; i++){
					var x = xArr[i];
					var y = maxY - yArr[i] + minY;
					if(i === 0){
						ctx .moveTo(x, y);
					}
					else{
						ctx .lineTo(x, y);
					}
				}
				ctx .stroke();

				//画点
				for(var i=0; i<len; i++){
					var x = xArr[i];
					var y = maxY - yArr[i] + minY;
					var xMemo = dict[i].x;
					var yMemo = dict[i].y;
					ctx.beginPath();
					ctx.fillStyle = "#000";
					ctx.arc(x, y, 2, 0, 2*Math.PI);//画点
					ctx.fill();
					ctx.fillText(yMemo, x + 3, y - 10);
					ctx.fillText(xMemo, x + 3, canvas.height - 10, 40);//画文字
				}
			}
			btn.onclick = load
		</script>
	</body>

